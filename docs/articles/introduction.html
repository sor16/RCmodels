<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • bdrc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="bdrc">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bdrc</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/background.html">Background</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to bdrc</a>
    </li>
    <li>
      <a href="../articles/tournament.html">Tournament - Model Comparison</a>
    </li>
    <li>
      <a href="../articles/advanced_visualization.html">Advanced Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/shiny_app.html">Shiny App</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sor16/bdrc/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
                        <h4 class="author">Sölvi Rögnvaldsson, Axel Örn Jansson, Rafael Vias and Birgir Hrafnkelsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sor16/bdrc/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>A discharge rating curve (drc) is a model that describes the relationship between water stage and discharge in a river. The rating curve is estimated from paired observations of stage and discharge and it’s used to predict discharge for a given stage. This is the main practical usage of rating curves as stage is substantially easier to directly observe than discharge. Four different discharge rating curve models are implemented in this R package using a Bayesian hierarchical model:</p>
<ul>
<li><p>plm0() - Power-law model with constant variance (hence the 0). This is a Bayesian hierarchical implementation of the most commonly used discharge rating curve model in hydrological practice</p></li>
<li><p>plm() - Power-law model with variance that may vary with stage</p></li>
<li><p>gplm0() - Generalized power-law model with constant variance (hence the 0)</p></li>
<li><p>gplm() - Generalized power-law model with variance that may vary with stage</p></li>
</ul>
<p>For further details about the different models, see x. The models differ in their complexity and the gplm is the most flexible and complex model. We will focus on the use of gplm throughout this introduction vignette and explore the different ways to fit the gplm and visualize its output. However the API of the functions for the other three models are completely identical so this vignette also helps users to run those models.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="co">#load the packages needed for this vignette</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(bdrc)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<p>We will use a dataset from a river called x in Sweden that comes with the package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(V316_river)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="op">&gt;</span><span class="st"> </span>V316_river</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;         W     Q</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; 1  1.2380  8.05</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; 2  1.2470  8.37</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; 3  1.2520  8.68</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; 4  1.2660  8.59</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; 5  1.2680  8.38</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 6  1.2770 10.50</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 7  1.2800  9.33</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; 8  1.2800  9.50</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; 9  1.2830  9.29</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; 10 1.2860  7.61</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 11 1.2960 10.20</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; 12 1.3000 10.10</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; 13 1.3010  9.58</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; 14 1.3100 10.35</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; 15 1.3250 11.20</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 16 1.3390 10.30</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 17 1.3450 11.10</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; 18 1.3520 10.90</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; 19 1.3540 12.40</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 20 1.3850 14.20</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; 21 1.4125 16.80</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; 22 1.4130 15.20</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; 23 1.4670 18.50</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; 24 1.4700 19.10</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt; 25 1.4800 19.40</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt; 26 1.5660 24.40</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt; 27 1.6260 27.50</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt; 28 1.6300 29.60</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt; 29 1.6580 31.70</span></a></code></pre></div>
<div id="fit-a-discharge-rating-curve" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-a-discharge-rating-curve" class="anchor"></a>Fit a discharge rating curve</h2>
<p>It is very simple to fit a discharge rating curve with the <em>bdrc</em> package. All you need are two mandatory input arguments, formula and data. The formula is of the form y~x where y is discharge in <span class="math inline">\(m^3/s\)</span> and x is stage in <span class="math inline">\(m\)</span> (it is very important that the data is in the correct units). data is a data.frame which must include x and y as column names. In our case, in V316_river, a column named Q includes are discharge measurements and W the stage measurements. We are ready to fit a drc using the gplm function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span>gplm.fit &lt;-<span class="st"> </span><span class="kw">gplm</span>(Q<span class="op">~</span>W,<span class="dt">data=</span>V316_river)</a></code></pre></div>
<p>gplm returns an object of class “gplm” which we can summarise and visualize using familiar functions such as</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(gplm.fit)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; Formula: </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;  Q ~ W</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Latent parameters:</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   lower-2.5% median-50% upper-97.5%</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; a 23.74      45.96      54.76      </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; b  1.83       1.84       1.84      </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; Hyperparameters:</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;            lower-2.5% median-50% upper-97.5%</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; c            0.55680   0.8570       0.944   </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; sigma_beta   0.00501   0.1417       0.773   </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; phi_beta     0.50184  16.6874    6042.652   </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; sigma_eta    0.00375   0.0885       0.484   </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; eta_1       -5.81894  -5.2651      -4.609   </span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; eta_2       -7.14255  -5.2252      -3.426   </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; eta_3       -8.05317  -5.4585      -2.672   </span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; eta_4       -8.81311  -5.6843      -2.206   </span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; eta_5       -9.58083  -5.8032      -1.758   </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; eta_6      -10.16377  -5.8954      -1.415   </span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; DIC: 78.67452</span></a></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We will dive deeper into visualizing the “gplm” object in the next sections.</p>
</div>
<div id="visualizing-posterior-distributions-of-different-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-posterior-distributions-of-different-parameters" class="anchor"></a>Visualizing posterior distributions of different parameters</h2>
<p>The bdrc package provides several tools to visualize the results from the drc model and can give insight into the physical properties of the river at hand. For instance, the hyperparameter <span class="math inline">\(c\)</span> corresponds to the stage of zero discharge. To visualize the posterior of <span class="math inline">\(c\)</span>, we can write</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'c'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"> Since <span class="math inline">\(c\)</span> is a strictly positive parameter, it is transformed during Bayesian inference s.t. it has support on the real line with <span class="math inline">\(\zeta=log(h_{min}-c)\)</span>. To plot the transformed posterior we write</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'c'</span>,<span class="dt">transformed=</span>T)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"> the param argument can also be a vector of different parameter names. To visualize the posterior distribution of many parameters at once we can for instance write</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="kw">c</span>(<span class="st">'a'</span>,<span class="st">'c'</span>))</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"> There is a shorthand to visualize all hyperparameters at once</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="960" style="display: block; margin: auto;"> Similairily, writing ‘latent_parameters’ plots the latent parameters in one plot. To plot the hyperparameters transformed, on the same scale as in the Bayesian inference, we write</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>,<span class="dt">transformed=</span>T)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Finally, we can visualize certain components of the drc models that may vary with stage, the power-law exponent <span class="math inline">\(f\)</span> and the standard deviation on the data level <span class="math inline">\(\sigma_{\varepsilon}\)</span>. gplm0 and gplm generalize the power law exponent, model it as a function of stage <span class="math inline">\(f(h)=b+\beta(h)\)</span>, while in plm and plm model the exponent is a fixed constant <span class="math inline">\(f(h)=b\)</span>. We can plot the exponent with</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'f'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"> plm and gplm model the standard deviation, <span class="math inline">\(\sigma_{\varepsilon}\)</span> on the data level as a function of stage, namely as a linear combination of B-splines functions, while plm and gplm0 model the variance is a fixed constant. We can plot the standard deviation by writing</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'sigma_eps'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="assessing-model-fitness-and-convergence" class="section level2">
<h2 class="hasAnchor">
<a href="#assessing-model-fitness-and-convergence" class="anchor"></a>Assessing model fitness and convergence</h2>
<p>The package has several functions for convergence diagnostics of a bdrc model, most notably the residual plot, tracing plots, autocorrelation plot and the Gelman-Rubin statistic. The residuals are presented as a function of <span class="math inline">\(log(h-c)\)</span> as the model is linear (or generalized linear) on that scale.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'residuals'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"> The traceplots are most meaningful on the transformed scale. To plot a trace plot for a single parameter, write</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'trace'</span>,<span class="dt">param=</span><span class="st">'c'</span>,<span class="dt">transformed=</span>T)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="960" style="display: block; margin: auto;"></p>
<p>To plot a trace plot for all hyperparameters, you write similiarily as above</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'trace'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>,<span class="dt">transformed=</span>T)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="960" style="display: block; margin: auto;"></p>
<p>To assess the mixing and convergence of the MCMC chains for each parameter, you can visualize <span class="math inline">\(\hat{R}\)</span> as presented by Gelman and Rubin with:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'r_hat'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="700" style="display: block; margin: auto;"> And finally autocorrelation of parameters can be assessed with</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'autocorrelation'</span>)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="customization-of-models" class="section level2">
<h2 class="hasAnchor">
<a href="#customization-of-models" class="anchor"></a>Customization of models</h2>
<p>There are ways to customize the gplm further. In some instances, the parameter of zero discharge, <span class="math inline">\(c\)</span>, is known and then you want to fix that parameter to the known value in the model. In addition you might want to extrapolate the rating curve to higher stage values by adjusting the maximum stage. Assume 0.75 m is the known value of <span class="math inline">\(c\)</span> and you want to calculate the rating curve for stage values up to 2.5 m, then your function call would look like this</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span>gplm.fit.known_c &lt;-<span class="st"> </span><span class="kw">gplm</span>(Q<span class="op">~</span>W,V316_river,<span class="dt">c_param=</span><span class="fl">0.75</span>,<span class="dt">h_max=</span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(gplm.fit.known_c)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt; Formula: </span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;  Q ~ W</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; Latent parameters:</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt;   lower-2.5% median-50% upper-97.5%</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; a 35.02      38.24      41.32      </span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; b  1.83       1.84       1.84      </span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; Hyperparameters:</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt;            lower-2.5% median-50% upper-97.5%</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; sigma_beta   0.14217   0.3207       0.802   </span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; phi_beta     0.44450  15.9516    8201.079   </span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; sigma_eta    0.00242   0.0848       0.469   </span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; eta_1       -5.84902  -5.2993      -4.677   </span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt; eta_2       -7.16061  -5.2419      -3.366   </span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; eta_3       -8.05881  -5.4521      -2.784   </span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt; eta_4       -8.84995  -5.6882      -2.351   </span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt; eta_5       -9.54548  -5.8367      -1.878   </span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">#&gt; eta_6      -10.19557  -5.8982      -1.334   </span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt; DIC: 77.61864</span></a></code></pre></div>
<p>one neat way to geta visualization summary of your model is to use the ‘collage’ option in the plot method:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit.known_c,<span class="dt">type=</span><span class="st">'panel'</span>,<span class="dt">transformed=</span>T)</a></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="prediction-for-an-equally-spaced-grid-of-stages" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-for-an-equally-spaced-grid-of-stages" class="anchor"></a>Prediction for an equally spaced grid of stages</h2>
<p>To get rating curve predictions for an equally spaced grid of stage values, you can use the predict function. Note that only values in the range from <span class="math inline">\(c\)</span> and h_max are accepted, as that is the range in which the Bayesian inference was performed</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span>h_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.75</span>,<span class="fl">2.0</span>,<span class="dt">by=</span><span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="op">&gt;</span><span class="st"> </span>rating_curve_h_grid &lt;-<span class="st"> </span><span class="kw">predict</span>(gplm.fit.known_c,<span class="dt">newdata=</span>h_grid)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(rating_curve_h_grid)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt;           h       lower       median       upper</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt; 1  0.750000  0.00000000   0.00000000   0.0000000</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; 2  0.800000  0.03074243   0.04795237   0.1303313</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt; 3  0.850000  0.15977058   0.22492026   0.4609612</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt; 4  0.900000  0.41954077   0.55514412   0.9583040</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt; 5  0.950000  0.83090623   1.05457728   1.5780384</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt; 6  1.000000  1.40711113   1.73385293   2.4138330</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt; 7  1.050000  2.15319557   2.59963574   3.3582516</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt; 8  1.100000  3.07848339   3.66230388   4.5488294</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt; 9  1.150000  4.20582259   4.93323957   5.9143725</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; 10 1.200000  5.51367510   6.40983953   7.5026782</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; 11 1.238000  6.60218931   7.67377308   8.9775799</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; 12 1.247000  6.88972646   7.99938494   9.2880720</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt; 13 1.252000  7.04868315   8.17843191   9.4705061</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; 14 1.266000  7.48964185   8.68724359  10.0772605</span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt; 15 1.268000  7.58690217   8.76486019  10.1685893</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20"><span class="co">#&gt; 16 1.277000  7.83842275   9.11538266  10.4976642</span></a>
<a class="sourceLine" id="cb20-21" data-line-number="21"><span class="co">#&gt; 17 1.280000  7.98999151   9.22223776  10.7069664</span></a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="co">#&gt; 18 1.283000  8.06906035   9.33033424  10.8010871</span></a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="co">#&gt; 19 1.286000  8.16920651   9.44156302  10.9072913</span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="co">#&gt; 20 1.296000  8.46586654   9.84190786  11.4304494</span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="co">#&gt; 21 1.300000  8.65562737  10.01924912  11.6453848</span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="co">#&gt; 22 1.301000  8.69201613  10.06084537  11.6223403</span></a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="co">#&gt; 23 1.310000  9.01585843  10.43775426  12.0545399</span></a>
<a class="sourceLine" id="cb20-28" data-line-number="28"><span class="co">#&gt; 24 1.325000  9.57640994  11.06145756  12.8350141</span></a>
<a class="sourceLine" id="cb20-29" data-line-number="29"><span class="co">#&gt; 25 1.339000 10.12218985  11.65356298  13.4495262</span></a>
<a class="sourceLine" id="cb20-30" data-line-number="30"><span class="co">#&gt; 26 1.345000 10.35815535  11.93547213  13.8001137</span></a>
<a class="sourceLine" id="cb20-31" data-line-number="31"><span class="co">#&gt; 27 1.352000 10.59799379  12.24800080  14.1661063</span></a>
<a class="sourceLine" id="cb20-32" data-line-number="32"><span class="co">#&gt; 28 1.354000 10.68873052  12.33705743  14.2750428</span></a>
<a class="sourceLine" id="cb20-33" data-line-number="33"><span class="co">#&gt; 29 1.385000 11.97798756  13.79993403  15.9133937</span></a>
<a class="sourceLine" id="cb20-34" data-line-number="34"><span class="co">#&gt; 30 1.412500 13.18111826  15.20856709  17.5413326</span></a>
<a class="sourceLine" id="cb20-35" data-line-number="35"><span class="co">#&gt; 31 1.413000 13.17106857  15.23400967  17.5829663</span></a>
<a class="sourceLine" id="cb20-36" data-line-number="36"><span class="co">#&gt; 32 1.431000 14.02777460  16.15138116  18.6761851</span></a>
<a class="sourceLine" id="cb20-37" data-line-number="37"><span class="co">#&gt; 33 1.449000 14.80512046  17.14178218  19.7822405</span></a>
<a class="sourceLine" id="cb20-38" data-line-number="38"><span class="co">#&gt; 34 1.467000 15.71286451  18.17635980  21.0055029</span></a>
<a class="sourceLine" id="cb20-39" data-line-number="39"><span class="co">#&gt; 35 1.470000 15.85203003  18.31430025  21.1577798</span></a>
<a class="sourceLine" id="cb20-40" data-line-number="40"><span class="co">#&gt; 36 1.480000 16.28862978  18.88171053  21.8451950</span></a>
<a class="sourceLine" id="cb20-41" data-line-number="41"><span class="co">#&gt; 37 1.508667 17.83393457  20.59210084  23.7121059</span></a>
<a class="sourceLine" id="cb20-42" data-line-number="42"><span class="co">#&gt; 38 1.537333 19.30361500  22.40214195  25.9697366</span></a>
<a class="sourceLine" id="cb20-43" data-line-number="43"><span class="co">#&gt; 39 1.566000 20.86428067  24.26016600  27.9314407</span></a>
<a class="sourceLine" id="cb20-44" data-line-number="44"><span class="co">#&gt; 40 1.586000 22.02481186  25.64557410  29.7179096</span></a>
<a class="sourceLine" id="cb20-45" data-line-number="45"><span class="co">#&gt; 41 1.606000 23.22879090  27.01621327  31.4473569</span></a>
<a class="sourceLine" id="cb20-46" data-line-number="46"><span class="co">#&gt; 42 1.626000 24.37794548  28.49576494  32.8439992</span></a>
<a class="sourceLine" id="cb20-47" data-line-number="47"><span class="co">#&gt; 43 1.630000 24.58807445  28.76302669  33.3031929</span></a>
<a class="sourceLine" id="cb20-48" data-line-number="48"><span class="co">#&gt; 44 1.658000 26.47365999  30.84061418  35.8476352</span></a>
<a class="sourceLine" id="cb20-49" data-line-number="49"><span class="co">#&gt; 45 1.704778 29.41923956  34.47916537  40.1040525</span></a>
<a class="sourceLine" id="cb20-50" data-line-number="50"><span class="co">#&gt; 46 1.751556 32.46201541  38.33421233  44.8774797</span></a>
<a class="sourceLine" id="cb20-51" data-line-number="51"><span class="co">#&gt; 47 1.798333 35.63975785  42.46924804  49.8964068</span></a>
<a class="sourceLine" id="cb20-52" data-line-number="52"><span class="co">#&gt; 48 1.845111 39.02747189  46.81152033  55.2124464</span></a>
<a class="sourceLine" id="cb20-53" data-line-number="53"><span class="co">#&gt; 49 1.891889 42.49393768  51.29452695  61.0397413</span></a>
<a class="sourceLine" id="cb20-54" data-line-number="54"><span class="co">#&gt; 50 1.938667 46.46568069  56.09786027  66.8862354</span></a>
<a class="sourceLine" id="cb20-55" data-line-number="55"><span class="co">#&gt; 51 1.985444 49.86723242  61.08915059  73.3627745</span></a>
<a class="sourceLine" id="cb20-56" data-line-number="56"><span class="co">#&gt; 52 2.032222 53.62634552  66.44894521  80.3674691</span></a>
<a class="sourceLine" id="cb20-57" data-line-number="57"><span class="co">#&gt; 53 2.079000 57.21218250  71.93721777  87.2608067</span></a>
<a class="sourceLine" id="cb20-58" data-line-number="58"><span class="co">#&gt; 54 2.125778 60.65152326  77.55180425  95.1010653</span></a>
<a class="sourceLine" id="cb20-59" data-line-number="59"><span class="co">#&gt; 55 2.172556 64.96215918  83.63328057 102.7512091</span></a>
<a class="sourceLine" id="cb20-60" data-line-number="60"><span class="co">#&gt; 56 2.219333 68.93893511  89.87534252 111.0292447</span></a>
<a class="sourceLine" id="cb20-61" data-line-number="61"><span class="co">#&gt; 57 2.266111 72.76587827  96.31151254 119.6761206</span></a>
<a class="sourceLine" id="cb20-62" data-line-number="62"><span class="co">#&gt; 58 2.312889 77.33685467 102.81881956 129.0720415</span></a>
<a class="sourceLine" id="cb20-63" data-line-number="63"><span class="co">#&gt; 59 2.359667 81.33088327 109.85044215 138.3009201</span></a>
<a class="sourceLine" id="cb20-64" data-line-number="64"><span class="co">#&gt; 60 2.406444 84.56005065 116.97931673 148.4343616</span></a>
<a class="sourceLine" id="cb20-65" data-line-number="65"><span class="co">#&gt; 61 2.453222 89.80072391 124.43026751 158.5898259</span></a>
<a class="sourceLine" id="cb20-66" data-line-number="66"><span class="co">#&gt; 62 2.500000 92.98358838 132.24713946 169.5976166</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://english.hi.is/staff/birgirhr">Birgir Hrafnkelsson</a>, <a href="https://github.com/sor16">Solvi Rognvaldsson</a>, <a href="https://github.com/axelornj">Axel Orn Jansson</a>, <a href="https://github.com/RafaelVias">Rafael Vias</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
